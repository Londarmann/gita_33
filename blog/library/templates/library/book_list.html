{% extends 'base.html' %}

{% block title %}წიგნები{% endblock %}

{% block content %}

<h1>ბიბლიოთეკა</h1>

<form method="get" action="{% url 'book_list' %}" class="book-card">
    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
        <input type="text" name="q" placeholder="მოძებნე წიგნი..." value="{{ q }}" class="form-control" style="flex: 1; min-width: 200px;">
        <select name="author" class="form-control" style="flex: 1; min-width: 150px;">
            <option value="">ყველა ავტორი</option>
            {% for author in authors %}
                <option value="{{ author.id }}" {% if author_id == author.id|stringformat:"s" %}selected{% endif %}>
                    {{ author.name }}
                </option>
            {% endfor %}
        </select>
        <button type="submit" class="btn btn-primary">ძებნა</button>
    </div>
</form>

<div class="grid">
    {% for book in books %}
        <div class="book-card">
            {% if book.cover %}
                <img src="{{ book.cover.url }}" alt="{{ book.title }}" class="book-cover">
            {% endif %}

            <h3><a href="{% url 'book_detail' book.id %}">{{ book.title }}</a></h3>
            <p class="text-muted">{{ book.author.name }}</p>
            <p>{{ book.published_year|default:"წელი უცნობია" }}</p>

            {# სტატუსი #}
            {% if book.open_loans %}
                <span class="badge badge-borrowed">
                    გატანილია: {{ book.open_loans.0.student.full_name }}
                </span>
            {% else %}
                <span class="badge badge-available">ხელმისაწვდომი</span>
            {% endif %}

            {% if book.tags.all %}
                <div class="mt-20">
                    {% for tag in book.tags.all %}
                        <span class="tag">{{ tag.name }}</span>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    {% empty %}
        <p>წიგნები ვერ მოიძებნა.</p>
    {% endfor %}
</div>

{% endblock %}